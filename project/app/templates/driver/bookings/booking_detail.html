{% extends 'base.html' %}

{% block title %}Ride Details - RideConnect{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Ride Details</h1>
                    <p class="text-gray-600">{{ booking.scheduled_pickup_time|date:"l, F j, Y" }}</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="px-3 py-1 rounded-full text-sm font-medium
                        {% if booking.status == 'driver_assigned' %}bg-green-100 text-green-800
                        {% elif booking.status == 'completed' %}bg-gray-100 text-gray-800
                        {% elif booking.status == 'cancelled' %}bg-red-100 text-red-800
                        {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                        {{ booking.get_status_display }}
                    </span>
                    <a href="{% url 'driver_bookings' %}" class="text-purple-600 hover:text-purple-700">
                        ← Back to Bookings
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Trip Details -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Trip Information</h2>
                    
                    <div class="space-y-6">
                        <!-- Pickup -->
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">Pickup Location</h3>
                                <p class="text-gray-600 mt-1">{{ booking.pickup_location }}</p>
                                <p class="text-sm text-gray-500 mt-2">
                                    {{ booking.scheduled_pickup_time|date:"g:i A" }}
                                    {% if booking.pickup_window_minutes %}
                                        (±{{ booking.pickup_window_minutes|floatformat:0 }} min window)
                                    {% endif %}
                                </p>
                            </div>
                        </div>

                        <!-- Dropoff -->
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">Dropoff Location</h3>
                                <p class="text-gray-600 mt-1">{{ booking.dropoff_location }}</p>
                                <p class="text-sm text-gray-500 mt-2">
                                    Est. duration: {{ booking.estimated_duration_minutes }} minutes
                                </p>
                            </div>
                        </div>

                        {% if booking.booking_type == 'round_trip' %}
                        <!-- Round Trip Info -->
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-900 mb-2">Round Trip</h4>
                            <p class="text-blue-800">
                                Waiting time: {{ booking.waiting_duration_minutes }} minutes at destination
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Passenger Information -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Passenger Information</h2>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-500">Name</span>
                            <p class="font-medium">{{ booking.rider.user.get_full_name|default:booking.rider.user.username }}</p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Contact</span>
                            <p class="font-medium">
                                <a href="tel:{{ booking.rider.user.username }}" class="text-purple-600 hover:text-purple-700">
                                    Call Passenger
                                </a>
                            </p>
                        </div>
                    </div>

                    {% if booking.special_requirements %}
                    <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h4 class="font-medium text-yellow-900 mb-2">Special Requirements</h4>
                        <p class="text-yellow-800">{{ booking.special_requirements }}</p>
                    </div>
                    {% endif %}

                    {% if booking.wheelchair_required %}
                    <div class="mt-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3.5 2.5a.5.5 0 00-1 0v8.793l-.646-.647a.5.5 0 00-.708.708l1.5 1.5a.5.5 0 00.708 0l1.5-1.5a.5.5 0 00-.708-.708L3.5 11.293V2.5z"/>
                            </svg>
                            Wheelchair Accessible Required
                        </span>
                    </div>
                    {% endif %}
                </div>

                <!-- Navigation (if within 1 hour) -->
                {% if nav_info %}
                <div class="bg-green-50 rounded-xl p-6 border border-green-200">
                    <h2 class="text-xl font-semibold text-green-900 mb-4">Navigation</h2>
                    <p class="text-green-800 mb-4">Pickup time approaching!</p>
                    <a href="{{ nav_info.maps_url }}" target="_blank" class="inline-flex items-center bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                        </svg>
                        Open in Maps
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Earnings -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Earnings</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Estimated Fare</span>
                            <span class="font-medium text-lg">€{{ booking.estimated_fare|floatformat:2 }}</span>
                        </div>
                        {% if booking.surge_multiplier > 1 %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Surge ({{ booking.surge_multiplier }}x)</span>
                            <span class="font-medium text-green-600">+€{{ booking.surge_amount|floatformat:2 }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Actions -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions</h3>
                    <div class="space-y-3">
                        {% if booking.status == 'driver_assigned' and booking.can_be_cancelled %}
                        <button onclick="confirmCancel()" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                            Cancel Ride
                        </button>
                        {% endif %}
                        
                        <a href="{% url 'driver_calendar' %}?date={{ booking.scheduled_pickup_time|date:'Y-m-d' }}" class="block w-full text-center border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                            View in Calendar
                        </a>
                    </div>
                </div>

                <!-- Optimization -->
                {% if optimization %}
                <div class="bg-purple-50 rounded-xl p-6 border border-purple-200">
                    <h3 class="text-lg font-semibold text-purple-900 mb-3">Waiting Time Optimization</h3>
                    <p class="text-purple-800 text-sm mb-4">
                        You have {{ booking.waiting_duration_minutes }} minutes waiting time at the destination.
                    </p>
                    <a href="{% url 'waiting_opportunities' optimization_id=optimization.id %}" class="text-purple-600 hover:text-purple-700 font-medium">
                        Find nearby rides →
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function confirmCancel() {
    if (confirm('Are you sure you want to cancel this ride? This action cannot be undone.')) {
        // TODO: Implement cancellation
        alert('Cancellation feature will be implemented soon.');
    }
}
</script>
{% endblock %}